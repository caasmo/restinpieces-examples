var $=Object.defineProperty,U=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var N=i=>{throw TypeError(i)};var A=(i,t,e)=>t in i?$(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,p=(i,t)=>{for(var e in t||(t={}))F.call(t,e)&&A(i,e,t[e]);if(S)for(var e of S(t))T.call(t,e)&&A(i,e,t[e]);return i},O=(i,t)=>U(i,W(t));var J=(i,t,e)=>A(i,typeof t!="symbol"?t+"":t,e),k=(i,t,e)=>t.has(i)||N("Cannot "+e);var y=(i,t,e)=>(k(i,t,"read from private field"),e?e.call(i):t.get(i)),C=(i,t,e)=>t.has(i)?N("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e);var d=(i,t,e)=>(k(i,t,"access private method"),e);var h=class extends Error{constructor(t){var e,s,n,u,o,l;super(((e=t==null?void 0:t.response)==null?void 0:e.message)||"ClientResponseError"),this.url=(t==null?void 0:t.url)||"",this.status=(t==null?void 0:t.status)||0,this.isAbort=!!(t!=null&&t.isAbort),this.originalError=t==null?void 0:t.originalError,this.response=(t==null?void 0:t.response)||{},this.name="ClientResponseError "+this.status,this.message=(s=this.response)==null?void 0:s.message,this.code=((n=this.response)==null?void 0:n.code)||"",this.message||(this.isAbort?this.message="The request was autocancelled.":(l=(o=(u=this.originalError)==null?void 0:u.cause)==null?void 0:o.message)!=null&&l.includes("ECONNREFUSED")?this.message="Failed to connect to the server":this.message="Something went wrong while processing your request.")}};var g,a,w,v,f=class f{constructor(){C(this,a)}loadAuth(){return d(this,a,w).call(this,"auth")}saveAuth(t){d(this,a,v).call(this,"auth",t)}isTokenValid(){try{let t=this.loadAuth();return t!=null&&t.access_token?JSON.parse(atob(t.access_token.split(".")[1])).exp>Date.now()/1e3:!1}catch(t){return!1}}loadProvider(){return d(this,a,w).call(this,"provider")}saveProvider(t){d(this,a,v).call(this,"provider",t)}loadEndpoints(){return d(this,a,w).call(this,"endpoints")}saveEndpoints(t){d(this,a,v).call(this,"endpoints",t)}};g=new WeakMap,a=new WeakSet,w=function(t){try{let e=localStorage.getItem(y(f,g)[t]);return e?JSON.parse(e):null}catch(e){throw console.error(`Failed to retrieve ${t}:`,e),new Error(`Failed to retrieve ${t}: `+e.message)}},v=function(t,e){try{localStorage.setItem(y(f,g)[t],JSON.stringify(e))}catch(s){throw console.error(`Failed to store ${t}:`,s),new Error(`Failed to store ${t}: `+s.message)}},C(f,g,{auth:"_rip_auth",provider:"_rip_provider",endpoints:"_rip_endpoints"});var E=f;var q=class{constructor(t){this.baseURL=t}requestJson(t,e="GET",s={},n=null,u={},o=null){let l=this.buildUrl(this.baseURL,t),c=this.serializeQueryParams(s);c&&(l+=(l.includes("?")?"&":"?")+c);let m=p({"Content-Type":"application/json"},u);return fetch(l,{method:e,headers:m,body:n?JSON.stringify(n):null,signal:o}).then(r=>r.ok?r.status===204?{}:r.json().catch(()=>{throw new h({url:r.url,status:r.status,response:{message:"Invalid JSON response"}})}):r.text().then(R=>{let _={};try{_=JSON.parse(R)}catch(j){_={message:R||"Unknown error"}}throw new h({url:r.url,status:r.status,response:_})})).catch(r=>{throw r instanceof h?r:r.name==="AbortError"?new h({url:l,isAbort:!0,originalError:r,response:{message:"Request aborted"}}):new h({url:l,originalError:r,response:{message:r.message||"Network or unknown error"}})})}buildUrl(t,e){if(t===""){let n=window.location.pathname.split("/");n.pop(),t=n.join("/")+"/"}let s;if(!t.startsWith("http://")&&!t.startsWith("https://")){let n=t.startsWith("/")?window.location.origin:window.location.href;s=new URL(t,n).href}else s=t;return e&&(s=s+(s.endsWith("/")?"":"/")+(e.startsWith("/")?e.substring(1):e)),s}serializeQueryParams(t){let e=[];for(let s in t){let n=encodeURIComponent(s),u=Array.isArray(t[s])?t[s]:[t[s]];for(let o of u)o!=null&&(o instanceof Date?o=o.toISOString().replace("T"," "):typeof o=="object"&&(o=JSON.stringify(o)),e.push(`${n}=${encodeURIComponent(o)}`))}return e.join("&")}};var P=class P{constructor(t={}){let e=p(p({},P.defaultConfig),t);this.baseURL=e.baseURL,this.lang=e.lang,this.storage=e.storage||new E,this.httpClient=new q(this.baseURL),this.endpointsPath=e.endpointsPath,this.endpointsPromise=null,this.store={auth:{save:s=>this.storage.saveAuth(s),load:()=>this.storage.loadAuth(),isValid:()=>this.storage.isTokenValid()},provider:{save:s=>this.storage.saveProvider(s),load:()=>this.storage.loadProvider()},endpoints:{save:s=>this.storage.saveEndpoints(s),load:()=>this.storage.loadEndpoints()}}}fetchEndpoints(){let t=this.store.endpoints.load();if(t)return Promise.resolve(t);if(!this.endpointsPromise){let[e,s]=this.endpointsPath.split(" ");this.endpointsPromise=this.httpClient.requestJson(s,e).then(n=>{if(!(n!=null&&n.data))throw new h({response:{message:"Empty endpoints response"}});return this.store.endpoints.save(n.data),this.endpointsPromise=null,n.data}).catch(n=>{throw this.endpointsPromise=null,console.error("Failed to fetch endpoints:",n),n})}return this.endpointsPromise}request(t,e={},s=null,n={},u=null){return this.fetchEndpoints().then(o=>{let l=o[t],[c,m]=l.split(" ");if(!m)throw new Error(`Endpoint "${t}" not found or invalid format in endpoints list.`);return this.httpClient.requestJson(m,c,e,s,n,u)}).catch(o=>{throw o instanceof h||console.error(`Error preparing request to "${t}":`,o),o})}requestAuth(t,e={},s=null,n={},u=null){let l=(this.store.auth.load()||{}).access_token||"";if(!l)return Promise.reject(new h({status:401,response:{message:"No authentication token available."}}));let c=O(p({},n),{Authorization:`Bearer ${l}`});return this.request(t,e,s,c,u)}refreshAuth(){return this.requestAuth("refresh_auth")}listOauth2Providers(){return this.request("list_oauth2_providers")}registerWithPassword(t=null,e={},s=null){return this.request("register_with_password",{},t,e,s)}requestEmailVerification(t=null,e={},s=null){return this.requestAuth("request_email_verification",{},t,e,s)}confirmEmailVerification(t=null,e={},s=null){return this.request("confirm_email_verification",{},t,e,s)}confirmEmailChange(t=null,e={},s=null){return this.request("confirm_email_change",{},t,e,s)}requestPasswordReset(t=null,e={},s=null){return this.request("request_password_reset",{},t,e,s)}requestEmailChange(t=null,e={},s=null){return this.requestAuth("request_email_change",{},t,e,s)}authWithPassword(t=null,e={},s=null){return this.request("auth_with_password",{},t,e,s)}authWithOauth2(t=null,e={},s=null){return this.request("auth_with_oauth2",{},t,e,s)}};J(P,"defaultConfig",{baseURL:"/",lang:"en-US",storage:null,endpointsPath:"GET /api/list-endpoints"});var b=P,X=b;export{p as a,O as b,X as c};
